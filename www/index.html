<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
    <link rel="stylesheet" type="text/css" href="css/gctrack.css" />
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <title>GCTrack</title>
</head>
<body>
    <div class="container-fluid">
        <img id="logologin" class="img-responsive" src="images/login_logo.png">
    </div>
    <div id="logincont"  class="container loginform">
        <div class="row">
            <div class="col-md-2 col-xs-2">
                <img class="img-user" src="images/login_user.png">
            </div>
            <div class="col-md-10 col-xs-10" style="padding-left:10%">
                <input id="inemail" name="mail" type="email" class="logininput" placeholder="Username" value="">
            </div>
        </div>
        <div class="row" style="margin-top:20px;">
            <div class="col-md-2 col-xs-2">
                <img class="img-user" src="images/login_pass.png">
            </div>
            <div class="col-md-10 col-xs-10" style="padding-left:10%">
                <input id="inpass" name="password" type="password" class="logininput" placeholder="Password" value="">
            </div>
        </div>
        <div class="logcont" style="margin-top:25px;">
            <input type="button" id="dologin" class="loginbutton" value="Enter">
        </div>
        <div class="logcont" style="margin-top:25px;">
            <input type="button" id="dohelp" class="loginbutton" value="About">
        </div>
      

   </div> 
    <div id="offlinediag" style="display:none;">
        <h2>No connection...</h2>
    </div>
    
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script type="text/javascript">
  var pushNotification;

document.addEventListener("deviceready", onDeviceReady, false);


function onDeviceReady() { //Método que se ejecuta al iniciar la aplicación.
pushNotification = window.plugins.pushNotification;
            pushNotification.register(tokenHandler, errorHandler, {"badge":"true","sound":"true","alert":"true","ecb":"onNotificationAPN"});    
   



}
  function onNotificationAPN(e) {
                if (e.alert) {
                     // showing an alert also requires the org.apache.cordova.dialogs plugin
                     navigator.notification.alert(e.alert);
                     alert("token"+e.alert);
                }
                    
                if (e.sound) {
                    // playing a sound also requires the org.apache.cordova.media plugin
                    var snd = new Media(e.sound);
                    snd.play();
                }
                
                if (e.badge) {
                    pushNotification.setApplicationIconBadgeNumber(successHandler, e.badge);
                }
            }
          


function tokenHandler (result) {
alert("token es resultado"+resultado);
                // Your iOS push server needs to know the token before it can push to this device
                // here is where you might want to send it the token for later use.
            }
            
            function successHandler (result) {
                $("#app-status-ul").append('<li>success:'+ result +'</li>');
            }
            
            function errorHandler (error) {
                $("#app-status-ul").append('<li>error:'+ error +'</li>');
            }
            



    $('#dologin').click(function(){
            inemail = $('#inemail').val();
            inpass = $('#inpass').val();
var token=window.localStorage.getItem("token");

            $.post( "http://gct-dev.mybluemix.net/auth.php", { email: inemail, pass: inpass })
             .done(function( data ) {
                var data=$.parseJSON(data);
				console.log(data);
                if(data.resp=='Correcto'){
 window.localStorage.setItem("iduser", data.iduser);  
window.localStorage.setItem("sucess","true"); 
  
alert("TOKEN VALOR"+token);
				   location.href='dashboard.html';
                   navigator.notification.alert("GC-Track will monitor your system on the background. Please, do not force this app to terminate or completely close it.", null, "Reminder", "OK");
                }else{
	navigator.notification.alert("Please check you email address and password", null, "Error", "OK");//metodo para crear alertas personalizadas

                }
             });

$.post("http://gct-dev.mybluemix.net/registerToken.php",{ TokenValue:token, id_user:window.localStorage.getItem("iduser") })
.done(function(data){






});


        });
        
		
		
		$('#dohelp').click(function(){
 		location.href='help.html';
		
		});
		$( document ).ready(function() {
            
            $.post( "http://gct-dev.mybluemix.net/auth.php", { loging: "Show" })
             .done(function( data ) {
               var data=$.parseJSON(data);
			   if(window.localStorage.getItem("sucess")=="true"){
                    location.href='dashboard.html';
                }else{
                   $('#logincont').fadeIn();
                }
             });
        });
	
    
	
	</script>
</body>
</html>
